<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>THE LIFE OF AKA KOBI - ARENA</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Syncopate:wght@700&display=swap');
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Syncopate', sans-serif; color: #fff; }
        
        /* SCREEN STYLING */
        .screen {
            position: fixed; inset: 0; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 10000; 
            background: #000; text-align: center; padding: 20px;
        }
        .intro-logo {
            width: 500px; max-width: 80%; height: auto; margin-bottom: 5px; 
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.5));
            animation: logoFloat 3s infinite ease-in-out;
        }
        @keyframes logoFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        /* UPDATED MISSION BRIEFING */
        h1 { color: #ffd700; font-size: 2.8rem; margin-bottom: 10px; text-shadow: 0 0 25px rgba(255, 215, 0, 0.7); }
        #briefing p { max-width: 600px; line-height: 1.8; color: #ffd700; margin-bottom: 30px; font-size: 1.1rem; text-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }

        .gold-btn { 
            background: #ffd700; color: #000; border: none; padding: 20px 60px; 
            font-size: 1.2rem; cursor: pointer; font-weight: 900; 
            text-transform: uppercase; letter-spacing: 4px;
            box-shadow: 0 0 30px rgba(255,215,0,0.4);
            transition: 0.3s;
        }
        .gold-btn:hover:not(:disabled) { background: #fff; transform: scale(1.05); }
        .gold-btn:disabled { background: #333; color: #666; cursor: not-allowed; box-shadow: none; }

        /* HUD & RADAR */
        #hud { position: fixed; top: 20px; left: 20px; display: none; z-index: 100; background: rgba(0,0,0,0.85); padding: 20px; border-left: 5px solid #ffd700; }
        .heat-container { width: 160px; height: 12px; background: rgba(255,255,255,0.1); margin-top: 10px; border: 1px solid #444; }
        #heat-bar { width: 0%; height: 100%; background: #0f0; transition: width 0.1s linear; }
        #radar-container { position: fixed; bottom: 25px; right: 25px; width: 180px; height: 180px; background: rgba(0, 10, 0, 0.9); border: 2px solid #ffd700; border-radius: 50%; display: none; z-index: 100; }
        #control-legend { position: fixed; bottom: 25px; left: 25px; display: none; background: rgba(0,0,0,0.7); padding: 15px; border: 1px solid #444; font-size: 0.7rem; color: #ffd700; line-height: 1.6; }
        #load-status { color: #ffd700; font-size: 2.5rem; margin: 20px 0; font-weight: 900; text-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
    </style>
</head>
<body>

<div id="gate" class="screen">
    <img src="logo.png" alt="AKA KOBI" class="intro-logo">
    <button class="gold-btn" id="enter-btn">ENTER ARENA</button>
</div>

<div id="briefing" class="screen" style="display:none;">
    <h1>MISSION BRIEFING</h1>
    <p>OBJECTIVE: GRAB 12 STACKS OF CASH.<br>GET TO THE BAG AND GRAB THAT CASH BEFORE TIME RUNS OUT.</p>
    <div id="load-status">0%</div>
    <button class="gold-btn" id="start-btn" disabled>START MISSION</button>
</div>

<div id="hud">
    <div class="hud-item">BAG: <span id="count" style="color:#ffd700">0</span>/12</div>
    <div class="hud-item" style="font-size: 1.6rem; font-weight: 900;">TIME: <span id="timer">1:30</span></div>
    <div class="hud-item" style="margin-top:10px;">ENGINE HEAT</div>
    <div class="heat-container"><div id="heat-bar"></div></div>
</div>

<div id="control-legend">
    <b>DESKTOP CONTROLS</b><br>
    [W,A,S,D] MOVE & STEER<br>
    [SPACE] HOLD FOR NITRO
</div>

<div id="radar-container"><canvas id="radar-canvas" width="180" height="180"></canvas></div>

<script type="module">
import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';
import { GLTFLoader } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/GLTFLoader.js';

class GarageGame {
    constructor() {
        this.active = false;
        this.items = [];
        this.collected = 0;
        this.timeLeft = 90;
        this.keys = {};
        this.heat = 0;
        this.overheated = false;
        this.music = new Audio('https://dl.dropboxusercontent.com/scl/fi/lg4b8xgncie3x1b1ez4h8/Igzotic-Money-chaser-Official-Music-Video.mp3?rlkey=umjddw56vwumbnd2qjkg0ft2e&raw=1');
        this.music.loop = true;
        this.init();
    }

    init() {
        this.scene = new THREE.Scene();
        this.scene.background = new THREE.Color(0x010103);
        this.camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        this.renderer = new THREE.WebGLRenderer({ antialias: true });
        this.renderer.setPixelRatio(window.devicePixelRatio);
        this.renderer.setSize(window.innerWidth, window.innerHeight);
        this.renderer.outputEncoding = THREE.sRGBEncoding;
        document.body.appendChild(this.renderer.domElement);

        this.scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 2.5));
        
        // YELLOW GEOMETRIC CONE PLAYER (RESTORED ACCURACY)
        this.player = new THREE.Group();
        const coneGeom = new THREE.ConeGeometry(0.5, 1.5, 12);
        const coneMat = new THREE.MeshStandardMaterial({ 
            color: 0xffd700, 
            emissive: 0xffd700, 
            emissiveIntensity: 0.5 
        });
        const cone = new THREE.Mesh(coneGeom, coneMat);
        cone.rotation.x = Math.PI / 2;
        this.player.add(cone);
        this.player.position.set(212, 1, -236);
        this.scene.add(this.player);

        window.addEventListener('keydown', e => this.keys[e.code] = true);
        window.addEventListener('keyup', e => this.keys[e.code] = false);
        this.ctx = document.getElementById('radar-canvas').getContext('2d');
        this.animate();
    }

    spawnCash() {
        // GREEN CASH STACKS
        const cashGeom = new THREE.BoxGeometry(0.8, 0.15, 0.4);
        const cashMat = new THREE.MeshStandardMaterial({ 
            color: 0x2e7d32, 
            emissive: 0x1b5e20, 
            emissiveIntensity: 1.5 
        });
        
        for(let i=0; i<12; i++) {
            const money = new THREE.Mesh(cashGeom, cashMat);
            const angle = Math.random() * 6.28;
            const dist = 30 + Math.random() * 140;
            money.userData.baseY = 0.8;
            money.position.set(212 + Math.cos(angle)*dist, money.userData.baseY, -236 + Math.sin(angle)*dist);
            money.rotation.y = Math.random() * Math.PI;
            this.items.push(money);
            this.scene.add(money);
        }
    }

    animate() {
        requestAnimationFrame(() => this.animate());
        const time = Date.now() * 0.002;

        if(this.active) {
            const bar = document.getElementById('heat-bar');
            if(this.keys['Space'] && !this.overheated) {
                this.heat = Math.min(100, this.heat + 0.8);
                if(this.heat >= 100) this.overheated = true;
            } else {
                this.heat = Math.max(0, this.heat - 0.4);
                if(this.heat <= 0) this.overheated = false;
            }
            bar.style.width = this.heat + "%";
            bar.style.background = this.overheated ? "#f00" : (this.heat > 70 ? "#ff0" : "#0f0");

            let isBoosting = this.keys['Space'] && !this.overheated;
            let speed = isBoosting ? 1.9 : 0.85;
            
            if(this.keys['KeyW']) this.player.translateZ(-speed);
            if(this.keys['KeyS']) this.player.translateZ(speed * 0.5);
            if(this.keys['KeyA']) this.player.rotation.y += 0.05;
            if(this.keys['KeyD']) this.player.rotation.y -= 0.05;

            this.items.forEach(m => {
                if(m.visible) {
                    // HOVER & SPIN
                    m.rotation.y += 0.05;
                    m.position.y = m.userData.baseY + Math.sin(time) * 0.4;

                    // PRECISION HITBOX
                    if(this.player.position.distanceTo(m.position) < 3.2) {
                        m.visible = false;
                        this.collected++;
                        document.getElementById('count').innerText = this.collected;
                    }
                }
            });

            this.ctx.clearRect(0,0,180,180);
            this.items.forEach(item => {
                if(item.visible) {
                    this.ctx.fillStyle = "#0f0";
                    this.ctx.beginPath();
                    this.ctx.arc(90 + (item.position.x - this.player.position.x)*0.4, 90 + (item.position.z - this.player.position.z)*0.4, 2, 0, 7);
                    this.ctx.fill();
                }
            });
            this.ctx.fillStyle = "#ffd700"; this.ctx.beginPath(); this.ctx.arc(90,90,4,0,7); this.ctx.fill();
        }
        
        const camOff = new THREE.Vector3(0, 7, 14).applyQuaternion(this.player.quaternion);
        this.camera.position.copy(this.player.position).add(camOff);
        this.camera.lookAt(this.player.position);
        this.renderer.render(this.scene, this.camera);
    }
}

const game = new GarageGame();

document.getElementById('enter-btn').onclick = () => {
    game.music.play().catch(()=>{});
    document.getElementById('gate').style.display = 'none';
    document.getElementById('briefing').style.display = 'flex';
    
    const loader = new GLTFLoader();
    loader.load('https://dl.dropboxusercontent.com/scl/fi/6ra7lo5htqjecxlv6w99f/arena.glb?rlkey=iqwd9sj1fva3k8t3z8fy9e9x2&raw=1', 
        (gltf) => {
            game.scene.add(gltf.scene);
            game.spawnCash();
            document.getElementById('load-status').style.display = "none";
            document.getElementById('start-btn').disabled = false;
        },
        (xhr) => {
            if (xhr.lengthComputable) {
                const percent = Math.round((xhr.loaded / xhr.total) * 100);
                document.getElementById('load-status').innerText = percent + "%";
            }
        }
    );
};

document.getElementById('start-btn').onclick = () => {
    document.getElementById('briefing').style.display = 'none';
    document.getElementById('hud').style.display = 'block';
    document.getElementById('radar-container').style.display = 'block';
    document.getElementById('control-legend').style.display = 'block';
    game.active = true;
    setInterval(() => {
        if(game.active) {
            game.timeLeft--;
            let m = Math.floor(game.timeLeft/60), s = game.timeLeft%60;
            document.getElementById('timer').innerText = `${m}:${s.toString().padStart(2,'0')}`;
        }
    }, 1000);
};
</script>
</body>
</html>
