<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>THE LIFE OF AKA KOBI</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial', sans-serif; }
        
        /* The Original Corner Logo */
        #game-logo {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 150px;
            z-index: 9999;
            pointer-events: none;
        }

        #start-trigger {
            position: fixed; inset: 0; background: #000; z-index: 5000;
            display: flex; align-items: center; justify-content: center;
            color: white; cursor: pointer; text-transform: uppercase; 
            letter-spacing: 10px; font-size: 3rem;
        }

        #menu {
            position: fixed; inset: 0; 
            background: url('https://dl.dropboxusercontent.com/scl/fi/8icpavjho04s8tcc5cqjs/ChatGPT-Image-Jan-6-2026-12_36_01-AM.png?rlkey=nr6na9w61icmcxh0wwexh8qte&raw=1') no-repeat center center;
            background-size: cover;
            display: none; flex-direction: column; align-items: center; justify-content: flex-end;
            z-index: 1000; padding-bottom: 80px;
        }

        #loading-ui { color: #ffd700; margin-bottom: 20px; font-weight: bold; font-size: 2rem; text-transform: uppercase; }
        
        #enter-btn { 
            background: white; color: black; border: none; padding: 20px 80px; 
            font-size: 1.5rem; cursor: pointer; text-transform: uppercase; font-weight: bold; 
            display: none; box-shadow: 0 0 20px #fff; 
        }

        #hud { 
            position: fixed; top: 10px; right: 10px; color: white; 
            background: rgba(0,0,0,0.5); padding: 10px; font-size: 12px; 
            pointer-events: none; border-radius: 5px; 
        }
    </style>
</head>
<body>

<img id="game-logo" src="https://raw.githubusercontent.com/akakobi401/garage-rush-desktop/main/logo.png" alt="Logo">

<div id="start-trigger">LET'S PLAY</div>

<div id="menu">
    <div id="loading-ui">PREPARING: <span id="percent">0</span>%</div>
    <button id="enter-btn">ENTER GARAGE</button>
</div>

<div id="hud">
    WASD: MOVE | SCROLL: ZOOM<br>
    PLUS/MINUS: MANUAL ZOOM
</div>

<script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
</script>

<script type="module">
import * as THREE from 'three';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
import { DRACOLoader } from 'three/addons/loaders/DRACOLoader.js';

class KobiGame {
    constructor() {
        this.assets = {
            arena: 'https://dl.dropboxusercontent.com/scl/fi/6ra7lo5htqjecxlv6w99f/arena.glb?rlkey=iqwd9sj1fva3k8t3z8fy9e9x2&raw=1',
            kobi: 'https://dl.dropboxusercontent.com/scl/fi/c9xbtomrvs8cm8t006fq/player.glb?rlkey=sb4tj4zr4x5kegbcp8qsn93g1&raw=1',
            music: 'https://dl.dropboxusercontent.com/scl/fi/lg4b8xgncie3x1b1ez4h8/Igzotic-Money-chaser-Official-Music-Video.mp3?rlkey=umjddw56vwumbnd2qjkg0ft2e&raw=1'
        };
        this.active = false;
        this.keys = {};
        this.zoomDistance = 45;
        this.displayPercent = 0;
        this.targetPercent = 0;
        this._init();
    }

    _init() {
        this.scene = new THREE.Scene();
        this.camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 15000);
        
        this.renderer = new THREE.WebGLRenderer({ antialias: true });
        this.renderer.setSize(window.innerWidth, window.innerHeight);
        this.renderer.outputColorSpace = THREE.SRGBColorSpace;
        this.renderer.shadowMap.enabled = true;
        document.body.appendChild(this.renderer.domElement);

        const ambient = new THREE.AmbientLight(0xffffff, 2.0);
        this.scene.add(ambient);

        const sun = new THREE.DirectionalLight(0xffffff, 3.0);
        sun.position.set(50, 150, 50);
        sun.castShadow = true;
        this.scene.add(sun);

        this.bgm = new Audio(this.assets.music);
        this.bgm.loop = true;

        window.onkeydown = (e) => this.keys[e.code] = true;
        window.onkeyup = (e) => this.keys[e.code] = false;

        document.getElementById('start-trigger').onclick = () => {
            this.bgm.play();
            document.getElementById('start-trigger').style.display = 'none';
            document.getElementById('menu').style.display = 'flex';
            this._load();
            this._animateCounter();
        };
    }

    _animateCounter() {
        if (this.displayPercent < this.targetPercent) {
            this.displayPercent++;
            document.getElementById('percent').innerText = this.displayPercent;
        }
        if (this.displayPercent < 100) setTimeout(() => this._animateCounter(), 25);
    }

    _load() {
        const manager = new THREE.LoadingManager(() => {
            this.targetPercent = 100;
            const check = setInterval(() => {
                if(this.displayPercent >= 100) {
                    document.getElementById('loading-ui').innerHTML = "GARAGE LOADED";
                    document.getElementById('enter-btn').style.display = 'block';
                    clearInterval(check);
                }
            }, 100);
        });

        const draco = new DRACOLoader();
        draco.setDecoderPath('https://www.gstatic.com/draco/versioned/decoders/1.5.6/');
        const loader = new GLTFLoader(manager);
        loader.setDRACOLoader(draco);

        loader.load(this.assets.arena, (gltf) => {
            this.arena = gltf.scene;
            this.scene.add(this.arena);
        }, (xhr) => this.targetPercent = Math.min(Math.round((xhr.loaded/xhr.total)*70), 99));

        loader.load(this.assets.kobi, (gltf) => {
            this.player = gltf.scene;
            this.scene.add(this.player);
            this.player.position.set(15, 0, 15);
            this.player.scale.setScalar(0.5); // Adjusting scale back to a basic setting
            this.mixer = new THREE.AnimationMixer(this.player);
            if(gltf.animations[0]) this.mixer.clipAction(gltf.animations[0]).play();
        }, (xhr) => this.targetPercent = Math.min(70 + Math.round((xhr.loaded/xhr.total)*30), 99));

        document.getElementById('enter-btn').onclick = () => {
            this.active = true;
            document.getElementById('menu').remove();
        };
        this._animate();
    }

    _animate() {
        requestAnimationFrame(() => this._animate());
        if(this.mixer) this.mixer.update(0.016);
        if(this.player && this.active) {
            const speed = 0.5;
            if(this.keys['KeyW']) this.player.translateZ(speed);
            if(this.keys['KeyS']) this.player.translateZ(-speed);
            if(this.keys['KeyA']) this.player.rotation.y += 0.05;
            if(this.keys['KeyD']) this.player.rotation.y -= 0.05;

            const offset = new THREE.Vector3(0, 15, -40).applyQuaternion(this.player.quaternion);
            this.camera.position.lerp(this.player.position.clone().add(offset), 0.1);
            this.camera.lookAt(this.player.position);
        } else {
            this.camera.position.set(80, 80, 150);
            this.camera.lookAt(0,0,0);
        }
        this.renderer.render(this.scene, this.camera);
    }
}
new KobiGame();
</script>
</body>
</html>
