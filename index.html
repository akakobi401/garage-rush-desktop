<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>THE LIFE OF AKA KOBI</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial', sans-serif; }
        
        /* LOGO: CENTERED & HOVERING AT START */
        #game-logo {
            position: fixed;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 280px;
            z-index: 6000;
            pointer-events: none;
            transition: all 1.2s cubic-bezier(0.19, 1, 0.22, 1);
            animation: bobbing 3s ease-in-out infinite;
        }

        @keyframes bobbing {
            0%, 100% { margin-top: 0px; }
            50% { margin-top: -25px; }
        }

        #start-trigger {
            position: fixed; inset: 0; background: #000; z-index: 5000;
            display: flex; align-items: flex-end; justify-content: center;
            color: white; cursor: pointer; text-transform: uppercase; 
            letter-spacing: 12px; font-size: 2rem; padding-bottom: 120px;
            font-weight: bold;
        }

        #menu {
            position: fixed; inset: 0; 
            background: url('https://dl.dropboxusercontent.com/scl/fi/8icpavjho04s8tcc5cqjs/ChatGPT-Image-Jan-6-2026-12_36_01-AM.png?rlkey=nr6na9w61icmcxh0wwexh8qte&raw=1') no-repeat center center;
            background-size: cover;
            display: none; flex-direction: column; align-items: center; justify-content: flex-end;
            z-index: 1000; padding-bottom: 80px;
        }

        #loading-ui { color: #ffd700; margin-bottom: 20px; font-weight: bold; font-size: 2.2rem; text-shadow: 2px 2px 10px #000; }
        #enter-btn { background: white; color: black; border: none; padding: 22px 90px; font-size: 1.4rem; cursor: pointer; font-weight: bold; display: none; text-transform: uppercase; }

        /* MISSION OBJECTIVE BOX */
        #objective {
            position: fixed;
            bottom: 40px;
            left: 40px;
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 20px;
            border-left: 6px solid #ffd700;
            display: none;
            z-index: 2000;
            max-width: 300px;
            line-height: 1.4;
        }

        #hud { position: fixed; top: 15px; right: 15px; color: white; background: rgba(0,0,0,0.7); padding: 12px; font-size: 11px; border-radius: 4px; letter-spacing: 1px; }
    </style>
</head>
<body>

<img id="game-logo" src="https://raw.githubusercontent.com/akakobi401/garage-rush-desktop/main/logo.png" alt="Logo">

<div id="start-trigger">LET'S PLAY</div>

<div id="menu">
    <div id="loading-ui">PREPARING: <span id="percent">0</span>%</div>
    <button id="enter-btn">ENTER GARAGE</button>
</div>

<div id="objective">
    <span style="color: #ffd700; font-weight: bold;">MISSION OBJECTIVE</span><br>
    Explore the garage and inspect the fleet.
</div>

<div id="hud">WASD: MOVE | SCROLL: ZOOM</div>

<script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
</script>

<script type="module">
import * as THREE from 'three';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
import { DRACOLoader } from 'three/addons/loaders/DRACOLoader.js';

class KobiGame {
    constructor() {
        this.assets = {
            arena: 'https://dl.dropboxusercontent.com/scl/fi/6ra7lo5htqjecxlv6w99f/arena.glb?rlkey=iqwd9sj1fva3k8t3z8fy9e9x2&raw=1',
            kobi: 'https://dl.dropboxusercontent.com/scl/fi/c9xbtomrvs8cm8t006fq/player.glb?rlkey=sb4tj4zr4x5kegbcp8qsn93g1&raw=1',
            music: 'https://dl.dropboxusercontent.com/scl/fi/lg4b8xgncie3x1b1ez4h8/Igzotic-Money-chaser-Official-Music-Video.mp3?rlkey=umjddw56vwumbnd2qjkg0ft2e&raw=1'
        };
        this.active = false;
        this.keys = {};
        this.displayPercent = 0;
        this.targetPercent = 0;
        this._init();
    }

    _init() {
        this.scene = new THREE.Scene();
        this.camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 15000);
        this.renderer = new THREE.WebGLRenderer({ antialias: true });
        this.renderer.setSize(window.innerWidth, window.innerHeight);
        this.renderer.outputColorSpace = THREE.SRGBColorSpace;
        document.body.appendChild(this.renderer.domElement);

        this.scene.add(new THREE.AmbientLight(0xffffff, 2.5));
        const sun = new THREE.DirectionalLight(0xffffff, 2.5);
        sun.position.set(10, 50, 10);
        this.scene.add(sun);

        this.bgm = new Audio(this.assets.music);
        this.bgm.loop = true;

        window.onkeydown = (e) => this.keys[e.code] = true;
        window.onkeyup = (e) => this.keys[e.code] = false;

        document.getElementById('start-trigger').onclick = () => {
            this.bgm.play();
            document.getElementById('start-trigger').style.display = 'none';
            document.getElementById('menu').style.display = 'flex';
            this._load();
            this._animateCounter();
        };
    }

    _animateCounter() {
        if (this.displayPercent < this.targetPercent) {
            this.displayPercent++;
            document.getElementById('percent').innerText = this.displayPercent;
        }
        if (this.displayPercent < 100) setTimeout(() => this._animateCounter(), 25);
    }

    _load() {
        const manager = new THREE.LoadingManager(() => {
            this.targetPercent = 100;
            const check = setInterval(() => {
                if(this.displayPercent >= 100) {
                    document.getElementById('loading-ui').innerText = "PREPARING COMPLETE";
                    document.getElementById('enter-btn').style.display = 'block';
                    clearInterval(check);
                }
            }, 100);
        });

        const draco = new DRACOLoader();
        draco.setDecoderPath('https://www.gstatic.com/draco/versioned/decoders/1.5.6/');
        const loader = new GLTFLoader(manager);
        loader.setDRACOLoader(draco);

        loader.load(this.assets.arena, (gltf) => this.scene.add(gltf.scene));
        loader.load(this.assets.kobi, (gltf) => {
            this.player = gltf.scene;
            this.player.scale.setScalar(0.5);
            this.player.position.set(15, 0, 15);
            this.scene.add(this.player);
            this.mixer = new THREE.AnimationMixer(this.player);
            if(gltf.animations[0]) this.mixer.clipAction(gltf.animations[0]).play();
        });

        document.getElementById('enter-btn').onclick = () => {
            this.active = true;
            document.getElementById('menu').remove();
            document.getElementById('objective').style.display = 'block';
            
            // Move logo to the top-left corner
            const logo = document.getElementById('game-logo');
            logo.style.animation = 'none';
            logo.style.top = '25px';
            logo.style.left = '25px';
            logo.style.transform = 'none';
            logo.style.width = '130px';
        };
        this._animate();
    }

    _animate() {
        requestAnimationFrame(() => this._animate());
        if(this.mixer) this.mixer.update(0.016);
        if(this.player && this.active) {
            if(this.keys['KeyW']) this.player.translateZ(0.5);
            if(this.keys['KeyS']) this.player.translateZ(-0.5);
            if(this.keys['KeyA']) this.player.rotation.y += 0.05;
            if(this.keys['KeyD']) this.player.rotation.y -= 0.05;

            const offset = new THREE.Vector3(0, 15, -45).applyQuaternion(this.player.quaternion);
            this.camera.position.lerp(this.player.position.clone().add(offset), 0.1);
            this.camera.lookAt(this.player.position.x, 6, this.player.position.z);
        } else {
            this.camera.position.set(80, 80, 150);
            this.camera.lookAt(0,0,0);
        }
        this.renderer.render(this.scene, this.camera);
    }
}
new KobiGame();
</script>
</body>
</html>
